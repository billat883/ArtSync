(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[590],{8826:function(e,t,s){Promise.resolve().then(s.bind(s,5205))},5205:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var i=s(7437),a=s(9376),r=s(2265),n=s(4418),c=s(2706),l=s(4552),d=s(9868);function o(e,t,s){if(!t.has(e))throw TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}function u(e,t){var s=o(e,t,"get");return s.get?s.get.call(e):s.value}function h(e,t,s){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function p(e,t,s){var i=o(e,t,"set");return!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,i,s),s}var m=s(3876),f=s(2134);function v(){return Math.floor(Date.now()/1e3)}var x=new WeakMap,g=new WeakMap,w=new WeakMap;class b{get key(){return u(this,w)}constructor(e,t,s,i){if(h(this,x,{writable:!0,value:void 0}),h(this,g,{writable:!0,value:void 0}),h(this,w,{writable:!0,value:void 0}),!m.UJ(s))throw TypeError("Invalid address ".concat(s));let a=t.sort(),r=e.createEIP712(null!=i?i:l.N,a,0,0),n=f.E.hash(r.domain,{UserDecryptRequestVerification:r.types.UserDecryptRequestVerification},r.message);p(this,x,a),p(this,g,s),p(this,w,"".concat(s,":").concat(n))}}var y=new WeakMap,D=new WeakMap,N=new WeakMap,j=new WeakMap,S=new WeakMap,T=new WeakMap,E=new WeakMap,k=new WeakMap;class C{get privateKey(){return u(this,D)}get publicKey(){return u(this,y)}get signature(){return u(this,N)}get contractAddresses(){return u(this,E)}get startTimestamp(){return u(this,j)}get durationDays(){return u(this,S)}get userAddress(){return u(this,T)}toJSON(){return{publicKey:u(this,y),privateKey:u(this,D),signature:u(this,N),startTimestamp:u(this,j),durationDays:u(this,S),userAddress:u(this,T),contractAddresses:u(this,E),eip712:u(this,k)}}static fromJSON(e){return new C("string"==typeof e?JSON.parse(e):e)}isValid(){return v()<u(this,j)+86400*u(this,S)}async saveToGenericStringStorage(e,t,s){try{let i=JSON.stringify(this),a=new b(t,u(this,E),u(this,T),s?u(this,y):void 0);await e.setItem(a.key,i)}catch(e){}}static async loadFromGenericStringStorage(e,t,s,i,a){try{let r=new b(t,s,i,a),n=await e.getItem(r.key);if(!n)return null;let c=C.fromJSON(n);if(!c.isValid())return null;return c}catch(e){return null}}static async new(e,t,s,i,a){try{let r=await a.getAddress(),n=v(),c=e.createEIP712(s,t,n,365),l=await a.signTypedData(c.domain,{UserDecryptRequestVerification:c.types.UserDecryptRequestVerification},c.message);return new C({publicKey:s,privateKey:i,contractAddresses:t,startTimestamp:n,durationDays:365,signature:l,eip712:c,userAddress:r})}catch(e){return null}}static async loadOrSign(e,t,s,i,a){let r=await s.getAddress(),n=await C.loadFromGenericStringStorage(i,e,t,r,null==a?void 0:a.publicKey);if(n)return n;let{publicKey:c,privateKey:l}=null!=a?a:e.generateKeypair(),d=await C.new(e,t,c,l,s);return d?(await d.saveToGenericStringStorage(i,e,!!(null==a?void 0:a.publicKey)),d):null}constructor(e){h(this,y,{writable:!0,value:void 0}),h(this,D,{writable:!0,value:void 0}),h(this,N,{writable:!0,value:void 0}),h(this,j,{writable:!0,value:void 0}),h(this,S,{writable:!0,value:void 0}),h(this,T,{writable:!0,value:void 0}),h(this,E,{writable:!0,value:void 0}),h(this,k,{writable:!0,value:void 0}),p(this,y,e.publicKey),p(this,D,e.privateKey),p(this,N,e.signature),p(this,j,e.startTimestamp),p(this,S,e.durationDays),p(this,T,e.userAddress),p(this,E,e.contractAddresses),p(this,k,e.eip712)}}var I=new WeakMap;class A{getItem(e){return u(this,I).has(e)?u(this,I).get(e):null}setItem(e,t){u(this,I).set(e,t)}removeItem(e){u(this,I).delete(e)}constructor(){h(this,I,{writable:!0,value:void 0}),p(this,I,new Map)}}var P=s(6822),M=s(8113),O=s(4114),F=s(8231);function L(){let e=(0,a.useSearchParams)().get("id"),t=e?Number(e):NaN,{provider:s,chainId:o,ethersSigner:u,ethersReadonlyProvider:h,initialMockChains:p,isConnected:m}=(0,n.D)(),{instance:f}=(0,c.a)({provider:s,chainId:o,enabled:!0,initialMockChains:p}),v=function(e){let{instance:t,chainId:s,ethersSigner:i,ethersReadonlyProvider:a}=e,[n,c]=(0,r.useState)(""),[o,u]=(0,r.useState)(void 0),[h,p]=(0,r.useState)(void 0),[m,f]=(0,r.useState)(void 0),[v,x]=(0,r.useState)(!1),[g,w]=(0,r.useState)(!1),b=(0,r.useRef)(new A),y=(0,r.useMemo)(()=>{let e=s?M.H[s.toString()]:void 0,t=(null==e?void 0:e.address)&&e.address!==l.N?e.address:void 0;return{abi:P.O.abi,address:t}},[s]),D=(0,r.useCallback)(async e=>{if(y.address&&a){x(!0);try{let t;let s=new d.CH(y.address,y.abi,a);try{t=await s.getExhibitHeader(e)}catch(i){t=await s.getExhibit(e)}u({id:t.id,organizer:t.organizer,metadataCID:t.metadataCID,startTime:t.startTime,endTime:t.endTime,mintPOAP:t.enablePass});let i=await s.getEncryptedAttendance(e);p(i),c("")}catch(e){u(void 0),p(void 0),c("Exhibit not found or failed to read. Please confirm the ID.")}finally{x(!1)}}},[y.address,y.abi,a]),N=(0,r.useCallback)(async()=>{if(!y.address||!t||!i||!h)return!1;try{c("Decrypting...");let e=await C.loadOrSign(t,[y.address],i,b.current);if(!e)return c("Unable to generate decryption signature"),!1;let s=(await t.userDecrypt([{handle:h,contractAddress:y.address}],e.privateKey,e.publicKey,e.signature,e.contractAddresses,e.userAddress,e.startTimestamp,e.durationDays))[h];return f("bigint"==typeof s?s:void 0),c("Decrypted"),!0}catch(e){return c("Decryption failed"),!1}},[y.address,t,i,h]),j=(0,r.useCallback)(async e=>{if(y.address&&t&&i&&!g){w(!0);try{let s=new d.CH(y.address,y.abi,i),a=await i.getAddress(),r=t.createEncryptedInput(y.address,a);r.add32(1);let n=await r.encrypt(),l=await s.checkInEncrypted(e,n.handles[0],n.inputProof);await l.wait(),c("Check-in succeeded"),await D(e)}catch(e){c("Check-in failed")}finally{w(!1)}}},[y.address,y.abi,t,i,g,D]);return{contractAddress:y.address,message:n,event:o,countHandle:h,clearCount:m,isRefreshing:v,isSigningIn:g,loadEvent:D,decryptCount:N,signIn:j}}({instance:f,chainId:o,ethersSigner:u,ethersReadonlyProvider:h}),[x,g]=(0,r.useState)(Math.floor(Date.now()/1e3)),[w,b]=(0,r.useState)(!1),[y,D]=(0,r.useState)(!1),[N,j]=(0,r.useState)(void 0),[S,T]=(0,r.useState)(void 0),[E,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!Number.isFinite(t))return;v.loadEvent(t);let e=setInterval(()=>g(Math.floor(Date.now()/1e3)),1e3);return()=>clearInterval(e)},[v.loadEvent,t]);let I=!!v.event&&Number(v.event.startTime)<=x,L=!!v.event&&x>Number(v.event.endTime),W=I&&!L&&m;return(0,i.jsxs)("div",{className:"min-h-screen",children:[(0,i.jsx)(O.w,{}),(0,i.jsxs)("main",{className:"mx-auto max-w-4xl px-6 py-12",children:[(0,i.jsx)("div",{className:"mb-8",children:(0,i.jsxs)("h2",{className:"text-4xl font-bold mb-2",children:["\uD83D\uDCCB Exhibit Details ",Number.isFinite(t)?"#".concat(t):""]})}),Number.isFinite(t)?v.event?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"card space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"Information"}),(0,i.jsxs)("div",{className:"space-y-2 text-white/80",children:[(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCE6 IPFS CID:"})," ",v.event.metadataCID]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"\uD83D\uDC64 Organizer:"})," ",v.event.organizer.slice(0,6),"...",v.event.organizer.slice(-4)]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"⏰ Starts:"})," ",new Date(1e3*Number(v.event.startTime)).toLocaleString()]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"⏰ Ends:"})," ",new Date(1e3*Number(v.event.endTime)).toLocaleString()]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"\uD83C\uDFA8 NFT Pass:"})," ",v.event.mintPOAP?"✅ Enabled":"❌ Disabled"]})]})]}),(0,i.jsxs)("div",{className:"text-right flex flex-col items-end gap-3",children:[(0,i.jsx)("button",{className:"btn-primary",onClick:async()=>{if(w){b(!1);return}if(!E)try{if(!f||!u||!v.contractAddress)throw Error("no instance/signer");let e=new A;if(!await C.loadOrSign(f,[v.contractAddress],u,e))throw Error("no signature");k(!0)}catch(e){j("Decryption authorization required (sign-in or organizer wallet)"),b(!0);return}if(b(!0),!S)try{D(!0),j(void 0);let e=v.event;if(!e)throw Error("event not loaded");let t=(0,F.i)(e.metadataCID),s=await fetch(t);if(!s.ok)throw Error("IPFS ".concat(s.status));let i=await s.json();T({title:i.title,location:i.location,description:i.description})}catch(e){j("Failed to fetch IPFS details")}finally{D(!1)}},children:w?"Hide details":E?"View details":"\uD83D\uDD10 View details (auth)"}),L?(0,i.jsx)("span",{className:"badge bg-gray-500/20 text-gray-300",children:"Ended"}):I?(0,i.jsx)("span",{className:"badge-success animate-pulse",children:"Ongoing"}):(0,i.jsx)("span",{className:"badge-warning",children:"Upcoming"})]})]}),w&&(0,i.jsx)("div",{className:"mt-4 p-4 rounded-xl bg-white/5 border border-white/10",children:y?(0,i.jsx)("p",{className:"text-white/70",children:"\uD83D\uDD04 Loading details from IPFS..."}):N?(0,i.jsx)("p",{className:"text-red-300",children:N}):S?(0,i.jsxs)("div",{className:"space-y-2",children:[S.title&&(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCDD Title:"})," ",S.title]}),S.location&&(0,i.jsxs)("p",{children:[(0,i.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCCD Location:"})," ",S.location]}),S.description&&(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-white/60",children:"\uD83D\uDCC4 Description:"}),(0,i.jsx)("p",{className:"whitespace-pre-wrap",children:S.description})]})]}):(0,i.jsx)("p",{className:"text-white/70",children:"No details found"})})]}),(0,i.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("h3",{className:"text-xl font-bold mb-4",children:"\uD83D\uDD10 Encrypted Stats"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"p-3 rounded-lg bg-white/5",children:[(0,i.jsx)("p",{className:"text-sm text-white/60 mb-1",children:"Encrypted count handle"}),(0,i.jsx)("p",{className:"font-mono text-xs break-all",children:v.countHandle||"Loading..."})]}),(0,i.jsxs)("div",{className:"p-3 rounded-lg bg-white/5",children:[(0,i.jsx)("p",{className:"text-sm text-white/60 mb-1",children:"Plain attendance"}),(0,i.jsx)("p",{className:"text-2xl font-bold",children:void 0!==v.clearCount?String(v.clearCount):"\uD83D\uDD12 Not decrypted"})]})]})]}),(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("h3",{className:"text-xl font-bold mb-4",children:"⚡ Actions"}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("button",{onClick:()=>Number.isFinite(t)&&v.signIn(t),disabled:!Number.isFinite(t)||!W||v.isSigningIn,className:"btn-gradient w-full disabled:opacity-50",children:v.isSigningIn?"\uD83D\uDD04 Checking in...":W?"✍️ Check-in now":L?"❌ Ended":I?"\uD83D\uDD17 Connect wallet first":"⏰ Not started"}),(0,i.jsx)("button",{onClick:v.decryptCount,disabled:!v.countHandle||!f||!u,className:"btn-primary w-full disabled:opacity-50",children:"\uD83D\uDD13 Decrypt attendance"})]})]})]}),v.message&&(0,i.jsx)("div",{className:"card ".concat(/success|succeed|decrypted/i.test(v.message)?"bg-green-500/10 border-green-400/30":/fail|error/i.test(v.message)?"bg-red-500/10 border-red-400/30":"bg-blue-500/10 border-blue-400/30"),children:(0,i.jsx)("p",{className:"font-medium",children:v.message})})]}):(0,i.jsxs)("div",{className:"card text-center py-12",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"⏳"}),(0,i.jsx)("p",{className:"text-white/60",children:v.message||"Loading exhibit..."})]}):(0,i.jsxs)("div",{className:"card text-center py-12",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"❓"}),(0,i.jsx)("p",{className:"text-white/60",children:"Missing or invalid event id. Try /event?id=1"})]})]})]})}function W(){return(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)("div",{className:"p-8 text-center text-white/60",children:"Loading..."}),children:(0,i.jsx)(L,{})})}},9376:function(e,t,s){"use strict";var i=s(5475);s.o(i,"useSearchParams")&&s.d(t,{useSearchParams:function(){return i.useSearchParams}})},257:function(e,t,s){"use strict";var i,a;e.exports=(null==(i=s.g.process)?void 0:i.env)&&"object"==typeof(null==(a=s.g.process)?void 0:a.env)?s.g.process:s(4227)},4227:function(e){!function(){var t={229:function(e){var t,s,i,a=e.exports={};function r(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{s="function"==typeof clearTimeout?clearTimeout:n}catch(e){s=n}}();var l=[],d=!1,o=-1;function u(){d&&i&&(d=!1,i.length?l=i.concat(l):o=-1,l.length&&h())}function h(){if(!d){var e=c(u);d=!0;for(var t=l.length;t;){for(i=l,l=[];++o<t;)i&&i[o].run();o=-1,t=l.length}i=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];l.push(new p(e,t)),1!==l.length||d||c(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var r=s[e]={exports:{}},n=!0;try{t[e](r,r.exports,i),n=!1}finally{n&&delete s[e]}return r.exports}i.ab="//";var a=i(229);e.exports=a}()},8231:function(e,t,s){"use strict";s.d(t,{i:function(){return a}});var i=s(257);function a(e){let t=(i.env.NEXT_PUBLIC_IPFS_GATEWAY||"https://ipfs.io/ipfs/").replace(/\/+$/,"");return"".concat(t,"/").concat(e)}}},function(e){e.O(0,[146,648,277,971,117,744],function(){return e(e.s=8826)}),_N_E=e.O()}]);