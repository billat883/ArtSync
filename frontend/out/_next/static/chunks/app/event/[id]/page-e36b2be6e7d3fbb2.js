(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{8999:function(e,t,s){Promise.resolve().then(s.bind(s,8631))},8631:function(e,t,s){"use strict";s.d(t,{default:function(){return F}});var a=s(7437),r=s(9376),i=s(4418),n=s(2706),c=s(2265),l=s(4552),d=s(9868);function o(e,t,s){if(!t.has(e))throw TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}function u(e,t){var s=o(e,t,"get");return s.get?s.get.call(e):s.value}function h(e,t,s){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function p(e,t,s){var a=o(e,t,"set");return!function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=s}}(e,a,s),s}var m=s(3876),f=s(2134);function v(){return Math.floor(Date.now()/1e3)}var x=new WeakMap,g=new WeakMap,w=new WeakMap;class y{get key(){return u(this,w)}constructor(e,t,s,a){if(h(this,x,{writable:!0,value:void 0}),h(this,g,{writable:!0,value:void 0}),h(this,w,{writable:!0,value:void 0}),!m.UJ(s))throw TypeError("Invalid address ".concat(s));let r=t.sort(),i=e.createEIP712(null!=a?a:l.N,r,0,0),n=f.E.hash(i.domain,{UserDecryptRequestVerification:i.types.UserDecryptRequestVerification},i.message);p(this,x,r),p(this,g,s),p(this,w,"".concat(s,":").concat(n))}}var b=new WeakMap,D=new WeakMap,N=new WeakMap,j=new WeakMap,S=new WeakMap,T=new WeakMap,E=new WeakMap,C=new WeakMap;class k{get privateKey(){return u(this,D)}get publicKey(){return u(this,b)}get signature(){return u(this,N)}get contractAddresses(){return u(this,E)}get startTimestamp(){return u(this,j)}get durationDays(){return u(this,S)}get userAddress(){return u(this,T)}toJSON(){return{publicKey:u(this,b),privateKey:u(this,D),signature:u(this,N),startTimestamp:u(this,j),durationDays:u(this,S),userAddress:u(this,T),contractAddresses:u(this,E),eip712:u(this,C)}}static fromJSON(e){return new k("string"==typeof e?JSON.parse(e):e)}isValid(){return v()<u(this,j)+86400*u(this,S)}async saveToGenericStringStorage(e,t,s){try{let a=JSON.stringify(this),r=new y(t,u(this,E),u(this,T),s?u(this,b):void 0);await e.setItem(r.key,a)}catch(e){}}static async loadFromGenericStringStorage(e,t,s,a,r){try{let i=new y(t,s,a,r),n=await e.getItem(i.key);if(!n)return null;let c=k.fromJSON(n);if(!c.isValid())return null;return c}catch(e){return null}}static async new(e,t,s,a,r){try{let i=await r.getAddress(),n=v(),c=e.createEIP712(s,t,n,365),l=await r.signTypedData(c.domain,{UserDecryptRequestVerification:c.types.UserDecryptRequestVerification},c.message);return new k({publicKey:s,privateKey:a,contractAddresses:t,startTimestamp:n,durationDays:365,signature:l,eip712:c,userAddress:i})}catch(e){return null}}static async loadOrSign(e,t,s,a,r){let i=await s.getAddress(),n=await k.loadFromGenericStringStorage(a,e,t,i,null==r?void 0:r.publicKey);if(n)return n;let{publicKey:c,privateKey:l}=null!=r?r:e.generateKeypair(),d=await k.new(e,t,c,l,s);return d?(await d.saveToGenericStringStorage(a,e,!!(null==r?void 0:r.publicKey)),d):null}constructor(e){h(this,b,{writable:!0,value:void 0}),h(this,D,{writable:!0,value:void 0}),h(this,N,{writable:!0,value:void 0}),h(this,j,{writable:!0,value:void 0}),h(this,S,{writable:!0,value:void 0}),h(this,T,{writable:!0,value:void 0}),h(this,E,{writable:!0,value:void 0}),h(this,C,{writable:!0,value:void 0}),p(this,b,e.publicKey),p(this,D,e.privateKey),p(this,N,e.signature),p(this,j,e.startTimestamp),p(this,S,e.durationDays),p(this,T,e.userAddress),p(this,E,e.contractAddresses),p(this,C,e.eip712)}}var I=new WeakMap;class A{getItem(e){return u(this,I).has(e)?u(this,I).get(e):null}setItem(e,t){u(this,I).set(e,t)}removeItem(e){u(this,I).delete(e)}constructor(){h(this,I,{writable:!0,value:void 0}),p(this,I,new Map)}}var P=s(6822),M=s(8113),O=s(4114),W=s(8231);function F(){let e=Number((0,r.useParams)().id),{provider:t,chainId:s,ethersSigner:o,ethersReadonlyProvider:u,initialMockChains:h,isConnected:p}=(0,i.D)(),{instance:m}=(0,n.a)({provider:t,chainId:s,enabled:!0,initialMockChains:h}),f=function(e){let{instance:t,chainId:s,ethersSigner:a,ethersReadonlyProvider:r}=e,[i,n]=(0,c.useState)(""),[o,u]=(0,c.useState)(void 0),[h,p]=(0,c.useState)(void 0),[m,f]=(0,c.useState)(void 0),[v,x]=(0,c.useState)(!1),[g,w]=(0,c.useState)(!1),y=(0,c.useRef)(new A),b=(0,c.useMemo)(()=>{let e=s?M.H[s.toString()]:void 0,t=(null==e?void 0:e.address)&&e.address!==l.N?e.address:void 0;return{abi:P.O.abi,address:t}},[s]),D=(0,c.useCallback)(async e=>{if(b.address&&r){x(!0);try{let t;let s=new d.CH(b.address,b.abi,r);try{t=await s.getExhibitHeader(e)}catch(a){t=await s.getExhibit(e)}u({id:t.id,organizer:t.organizer,metadataCID:t.metadataCID,startTime:t.startTime,endTime:t.endTime,mintPOAP:t.enablePass});let a=await s.getEncryptedAttendance(e);p(a),n("")}catch(e){u(void 0),p(void 0),n("Exhibit not found or failed to read. Please confirm the ID.")}finally{x(!1)}}},[b.address,b.abi,r]),N=(0,c.useCallback)(async()=>{if(!b.address||!t||!a||!h)return!1;try{n("Decrypting...");let e=await k.loadOrSign(t,[b.address],a,y.current);if(!e)return n("Unable to generate decryption signature"),!1;let s=(await t.userDecrypt([{handle:h,contractAddress:b.address}],e.privateKey,e.publicKey,e.signature,e.contractAddresses,e.userAddress,e.startTimestamp,e.durationDays))[h];return f("bigint"==typeof s?s:"string"==typeof s?BigInt(s):void 0),n("Decrypted"),!0}catch(e){return n("Decryption failed"),!1}},[b.address,t,a,h]),j=(0,c.useCallback)(async e=>{if(b.address&&t&&a&&!g){w(!0);try{let s=new d.CH(b.address,b.abi,a),r=await a.getAddress(),i=t.createEncryptedInput(b.address,r);i.add32(1);let c=await i.encrypt(),l=await s.checkInEncrypted(e,c.handles[0],c.inputProof);await l.wait(),n("Check-in succeeded"),await D(e)}catch(e){n("Check-in failed")}finally{w(!1)}}},[b.address,b.abi,t,a,g,D]);return{contractAddress:b.address,message:i,event:o,countHandle:h,clearCount:m,isRefreshing:v,isSigningIn:g,loadEvent:D,decryptCount:N,signIn:j}}({instance:m,chainId:s,ethersSigner:o,ethersReadonlyProvider:u}),[v,x]=(0,c.useState)(Math.floor(Date.now()/1e3)),[g,w]=(0,c.useState)(!1),[y,b]=(0,c.useState)(!1),[D,N]=(0,c.useState)(void 0),[j,S]=(0,c.useState)(void 0),[T,E]=(0,c.useState)(!1);(0,c.useEffect)(()=>{f.loadEvent(e);let t=setInterval(()=>x(Math.floor(Date.now()/1e3)),1e3);return()=>clearInterval(t)},[f.loadEvent,e]);let C=!!f.event&&Number(f.event.startTime)<=v,I=!!f.event&&v>Number(f.event.endTime),F=C&&!I&&p;return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(O.w,{}),(0,a.jsxs)("main",{className:"mx-auto max-w-4xl px-6 py-12",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("h2",{className:"text-4xl font-bold mb-2",children:["\uD83D\uDCCB Exhibit Details #",e]})}),f.event?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"card space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-2",children:"Information"}),(0,a.jsxs)("div",{className:"space-y-2 text-white/80",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCE6 IPFS CID:"})," ",f.event.metadataCID]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"\uD83D\uDC64 Organizer:"})," ",f.event.organizer.slice(0,6),"...",f.event.organizer.slice(-4)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"⏰ Starts:"})," ",new Date(1e3*Number(f.event.startTime)).toLocaleString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"⏰ Ends:"})," ",new Date(1e3*Number(f.event.endTime)).toLocaleString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"\uD83C\uDFA8 NFT Pass:"})," ",f.event.mintPOAP?"✅ Enabled":"❌ Disabled"]})]})]}),(0,a.jsxs)("div",{className:"text-right flex flex-col items-end gap-3",children:[(0,a.jsx)("button",{className:"btn-primary",onClick:async()=>{if(g){w(!1);return}if(!T)try{if(!m||!o||!f.contractAddress)throw Error("no instance/signer");let e=new A;if(!await k.loadOrSign(m,[f.contractAddress],o,e))throw Error("no signature");E(!0)}catch(e){N("Decryption authorization required (sign-in or organizer wallet)"),w(!0);return}if(w(!0),!j)try{b(!0),N(void 0);let e=f.event;if(!e)throw Error("no event");let t=(0,W.i)(e.metadataCID),s=await fetch(t);if(!s.ok)throw Error("IPFS ".concat(s.status));let a=await s.json();S({title:a.title,location:a.location,description:a.description})}catch(e){N("Failed to fetch IPFS details")}finally{b(!1)}},children:g?"Hide details":T?"View details":"\uD83D\uDD10 View details (auth)"}),I?(0,a.jsx)("span",{className:"badge bg-gray-500/20 text-gray-300",children:"Ended"}):C?(0,a.jsx)("span",{className:"badge-success animate-pulse",children:"Ongoing"}):(0,a.jsx)("span",{className:"badge-warning",children:"Upcoming"})]})]}),g&&(0,a.jsx)("div",{className:"mt-4 p-4 rounded-xl bg-white/5 border border-white/10",children:y?(0,a.jsx)("p",{className:"text-white/70",children:"\uD83D\uDD04 Loading details from IPFS..."}):D?(0,a.jsx)("p",{className:"text-red-300",children:D}):j?(0,a.jsxs)("div",{className:"space-y-2",children:[j.title&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCDD Title:"})," ",j.title]}),j.location&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-white/60",children:"\uD83D\uDCCD Location:"})," ",j.location]}),j.description&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-white/60",children:"\uD83D\uDCC4 Description:"}),(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:j.description})]})]}):(0,a.jsx)("p",{className:"text-white/70",children:"No details found"})})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"\uD83D\uDD10 Encrypted Stats"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-white/5",children:[(0,a.jsx)("p",{className:"text-sm text-white/60 mb-1",children:"Encrypted count handle"}),(0,a.jsx)("p",{className:"font-mono text-xs break-all",children:f.countHandle||"Loading..."})]}),(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-white/5",children:[(0,a.jsx)("p",{className:"text-sm text-white/60 mb-1",children:"Plain attendance"}),(0,a.jsx)("p",{className:"text-2xl font-bold",children:void 0!==f.clearCount?String(f.clearCount):"\uD83D\uDD12 Not decrypted"})]})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"⚡ Actions"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>f.signIn(e),disabled:!F||f.isSigningIn,className:"btn-gradient w-full disabled:opacity-50",children:f.isSigningIn?"\uD83D\uDD04 Checking in...":F?"✍️ Check-in now":I?"❌ Ended":C?"\uD83D\uDD17 Connect wallet first":"⏰ Not started"}),(0,a.jsx)("button",{onClick:f.decryptCount,disabled:!f.countHandle||!m||!o,className:"btn-primary w-full disabled:opacity-50",children:"\uD83D\uDD13 Decrypt attendance"})]})]})]}),f.message&&(0,a.jsx)("div",{className:"card ".concat(/success|succeed|decrypted/i.test(f.message)?"bg-green-500/10 border-green-400/30":/fail|error/i.test(f.message)?"bg-red-500/10 border-red-400/30":"bg-blue-500/10 border-blue-400/30"),children:(0,a.jsx)("p",{className:"font-medium",children:f.message})}),(0,a.jsxs)("div",{className:"card bg-blue-500/10 border-blue-400/20",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"\uD83D\uDCA1 Tips"}),(0,a.jsxs)("ul",{className:"text-sm text-white/70 space-y-1 list-disc list-inside",children:[(0,a.jsx)("li",{children:"Client encrypts inputs with FHE; the contract verifies and accumulates encrypted counts"}),(0,a.jsx)("li",{children:"Decryption requires EIP-712 authorization; only authorized users can decrypt"}),(0,a.jsx)("li",{children:"If NFT passes are enabled, successful check-in allows pass minting"})]})]})]}):(0,a.jsxs)("div",{className:"card text-center py-12",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"⏳"}),(0,a.jsx)("p",{className:"text-white/60",children:f.message||"Loading exhibit..."}),f.message&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("a",{href:"/organizer",className:"btn-primary",children:"← Back to dashboard"})})]})]})]})}},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},257:function(e,t,s){"use strict";var a,r;e.exports=(null==(a=s.g.process)?void 0:a.env)&&"object"==typeof(null==(r=s.g.process)?void 0:r.env)?s.g.process:s(4227)},4227:function(e){!function(){var t={229:function(e){var t,s,a,r=e.exports={};function i(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{s="function"==typeof clearTimeout?clearTimeout:n}catch(e){s=n}}();var l=[],d=!1,o=-1;function u(){d&&a&&(d=!1,a.length?l=a.concat(l):o=-1,l.length&&h())}function h(){if(!d){var e=c(u);d=!0;for(var t=l.length;t;){for(a=l,l=[];++o<t;)a&&a[o].run();o=-1,t=l.length}a=null,d=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];l.push(new p(e,t)),1!==l.length||d||c(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},s={};function a(e){var r=s[e];if(void 0!==r)return r.exports;var i=s[e]={exports:{}},n=!0;try{t[e](i,i.exports,a),n=!1}finally{n&&delete s[e]}return i.exports}a.ab="//";var r=a(229);e.exports=r}()},8231:function(e,t,s){"use strict";s.d(t,{i:function(){return r}});var a=s(257);function r(e){let t=(a.env.NEXT_PUBLIC_IPFS_GATEWAY||"https://ipfs.io/ipfs/").replace(/\/+$/,"");return"".concat(t,"/").concat(e)}}},function(e){e.O(0,[146,648,277,971,117,560],function(){return e(e.s=8999)}),_N_E=e.O()}]);